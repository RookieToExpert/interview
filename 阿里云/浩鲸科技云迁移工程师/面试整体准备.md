## 先前工作和当前工作的区别
在 Azure 上我更多是做 VM 层的迁移，通过 Azure Migrate/DMS 去实现 Rehost/Replatform，
#### Rehost关注的点：
主要关注：磁盘、网络、计算兼容性
工具：Azure Migrate、SMS、VHD/镜像导入
假设：VM 上的服务 整体打包 上云，黑箱式搬迁
数据一致性：靠 块级复制 / VSS 快照 保证一致性,不关心文件或数据库的结构，只看底层存储盘的“块”（block）。类似于磁盘快照（snapshot）、bit-by-bit 拷贝，把源磁盘的数据块同步到目标磁盘。

#### Replatform关注的点：
主要关注：组件的数据结构、协议兼容性、消费/位点、持久化状态
工具：DTS、MirrorMaker、mongosync、快照/restore、Velero
假设：只迁移应用依赖的那部分服务，目标可能是托管化（RDS、ES Cloud、CKafka）
数据一致性：靠 全量 + 增量同步、日志回放、offset 校验，先把所有已有的数据复制一遍（dump & restore、snapshot & restore）。在全量完成后，持续同步新增/修改的数据（通常基于日志，如 MySQL Binlog、Mongo Oplog、Kafka offset），和块级复制相比，全量+增量是在 应用层 做的数据同步，能保证 应用语义一致，而不是仅仅拷贝底层磁盘。利用数据库/消息系统自身的复制机制，确保复制的是“已提交事务”“已确认消息”。

例如数据库会用 全量+增量复制 来保证一致性，Kafka 会用 MirrorMaker 做 offset 对齐，ES 会用 快照+增量回放，Redis 会用 主从复制链路。这些方法比 VM 层的块级复制更细粒度，能保证业务在迁移后继续稳定运行。

所以我在 Azure 积累的是 迁移方法论（发现→评估→迁移→验证→回滚），如果面向开源组件，我会再结合具体的 增量同步和切换策略 来保证一致性。

1. MySQL → 云上 RDS (阿里/腾讯)
    1. 前期评估：确认版本兼容（5.7/8.0）、字符集/时区、存储引擎（InnoDB/MyISAM）、触发器/存储过程。

    2. 网络打通：配置 VPC/VPN/专线/SSL，确保源 MySQL 能与云上 DTS 通信。

    3. 目标准备：创建 RDS MySQL 实例，分配账号、参数组、白名单。

    4. 全量迁移：DTS 执行全量数据导入（或 mysqldump → 云 RDS → 导入）。

    5. 增量同步：基于 Binlog（GTID/位点），DTS 持续增量复制。

    6. 一致性校验：pt-table-checksum / rowcount 对比，检查数据差异。

    7. 演练切换：只读实例挂到应用端，观察查询一致性，预演回退。

    8. 正式割接：短停写入 → 增量追平 → 应用端改连接串 → 监控告警生效。

2. Kafka → CKafka / 阿里云 Kafka

    1. 前期评估：确认 Topic 数量、分区、副本数、消息量峰值、压缩格式。

    2. 目标准备：新建 CKafka 集群，Topic/分区配置与源保持一致。

    3. 网络打通：源 Kafka 与目标 CKafka 建立 VPC/VPN/专线或公网 SSL 通道。

    4. 同步工具：部署 MirrorMaker2 / Confluent Replicator 做跨集群同步。

    5. Topic 镜像：源 → 目标 Topic 消息双写，保持消费 offset。

    6. 消费组演练：在目标 CKafka 上启动部分消费者，校验 offset 对齐与消息完整性。

    7. 灰度切流：逐步迁移消费端 → 生产端双写/单写 → 回退脚本预置。

    8. 正式割接：所有生产者指向目标 CKafka，保留源端只读观察一段时间。

3. Elasticsearch → 云 ES

    1. 前期评估：确认版本差异、插件兼容性、索引模板、Analyzer 配置。

    2. 目标准备：开通云 Elasticsearch 实例，设置分片、副本、ILM 策略。

    3. 快照仓库：源 ES 注册 OSS/COS 作为 Snapshot Repository。

    4. 全量迁移：执行 snapshot → restore 到目标云 ES。

    5. 增量迁移：Logstash / Beats / Kafka Replay 将新增日志持续写入目标 ES。

    6. 索引校验：比对索引数量、文档数、分片健康状态（green/ yellow）。

    7. 演练切换：部分查询流量切到目标，观察响应时间和结果一致性。

    8. 正式割接：全部查询/写入指向目标，源 ES 保持只读观测。