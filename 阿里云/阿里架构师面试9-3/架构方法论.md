## 云架构设计方法论
1. TOGAF(Preliminary → Business Architecture → Application Architecture → Data Architecture → Technology Architecture → Opportunities&Solutions → Migration Planning → Implementation Governance → Architecture Change Management → Requirements Management)：
    1. 准备阶段，定义架构原则，目标和约束条件：
        - 确认客户上云的目标，比如是为了降本增效、数字化/AI转型、云的弹性，以及客户的侧重点是什么。
        - 确认约束条件，安全合规和预算边界。
        
        ### 话术：比如确定哪些系统必须满足合规要求，比如金融行业的等保/PCI-DSS。

    2. **业务架构**，理解企业核心业务流程、组织结构、战略目标。
        - 识别核心系统（ERP、CRM、MES）。
            > ERP 是核心调度，PLM 管设计，MES 管制造，WMS 管仓库，QMS 管质量，SCADA 管设备，OA 管流程，CRM/SCM 管客户与供应链。 

            ![alt text](/阿里云/阿里架构师面试9-3/image/image.png)

        - 区分业务关键性（核心系统 vs 支撑系统）。

       ### 话术：我们会先从业务视角出发，理解企业核心的业务流程，理解客户的核心系统，比如银行中的CBS(核心银行系统)，风控系统，电商的订单清单/库存/物流体系(ERP + CRM + SCM)和推荐算法(AI/大数据)系统，这些系统一旦停机就会导致业务中断，然后区分可分阶段迁移的支撑系统。这一阶段可做一个初步的RPO/RTO目标，并产出系统优先级矩阵（业务价值 × 技术复杂度）。

    3. 信息系统架构：
        - **应用架构**：应用如何组合，依赖关系如何。
            - 在云里：哪些应用 SaaS 化，哪些容器化，哪些迁移到 VM。
        - **数据架构**：数据流转、存储方式。
            - 在云里：数据库迁移到 RDS，日志数据进大数据平台。
        
        ### 话术：分析各个系统中具体的应用架构和数据架构，应用架构包括根据应用之间依赖关系去组合，数据架构理解数据的流转、存储方式等。再具体分析架构中各应用是否允许改动，是否需要适合升级优化，是否需要做更改重写(更换中间件，更改后端数据后库等)，迁移策略实施矩阵(六个R)，Rehost(搬运)，Replatform(升级操作系统)，Repurchase(替换现有应用)，Refactor(重写)，Retire(退役)，Retain(保留在本地)。
        - **Rehost** 服务器，没有积极升级路线图的应用，或者测试，开发环境直接搬到云上，本地更改最少。
        - **RePlatform**本地老的OS系统上云的时候进行升级,或者应用系统升级比如oracle8升级到oracle11。
        - **Repurchase**用saas方式或商用现成品软件替代已有软件。
        - **Refactor**之间维护软件工程师已离职，找不到第三方vendor支持的应用等原因，或者本地架构可能是一体化，又大又蠢的形式，希望使用云端松耦合形式，那么就会对组件进行重构设计，可能包含更改后端数据库，更换中间件，重构应用架构。
        - **Retire**退役本地某些服务器，比如由于合并或者收购产生的重复资源。
        - **Retain**不移动本地某些服务器，没有上云价值的legacy应用。    

            ![alt text](/阿里云/阿里架构师面试9-3/image/image1.png)

    4. **技术架构**，描述实现所需的技术组件：
        - 在云里：
            - 计算（ECS/VM、容器、Serverless）。
            - 存储（对象、块、文件）。
            - 网络（VPC、负载均衡、CDN、专线）。
            - 安全（WAF、防火墙、IAM）。
    
    ### 话术：在技术层面，会设计一个高可用的云原生架构：前端走 CDN+WAF，入口走ALB/SLB, 身份和密钥可以通过RAM/KMS管理，应用层用ACK/函数计算，数据库可以使用PolarDB/RDS(高可用/读写分离),Redis，RocketMQ，OSS等，可以通过ADB/MaxCompute做风控和合规，监控方面可以用阿里云原生的CloudMonitor和ARMS，SLS日志服务，网络可以使用基本的VPC，与本地互联可通过Express Connect或者VPN。

    5. **机会与解决方案**，把前面三层架构转化为落地方案：
        - 在云里：
            - 做 TCO 对比（成本 vs 本地机房）。
            - 选择云服务产品组合（ACK、OSS、RDS、Log Service）。
    
    ### 话术：结合客户预算，我们推荐采用对象存储OSS替代原有 NAS，数据库迁移到云上托管 RDS，或用SLS，CloudMontior代替本地监控和日志系统，也可以使用云端ACK逐步替代本地K8s集群，以及可以用函数计算取代一些后端不常用的API，实现减少运维成本，提升效率，提高高可用等。

    6. **迁移规划**，制定迁移路线图，分阶段执行：
        - 在云里：
            - 先 POC → 再分批迁移 → 最后核心系统。
            - 蓝绿/灰度/双活等切换策略。
    
    ### 话术：迁移采用分阶段方式，小步快跑，第一阶段先迁辅助系统做验证，第二阶段迁核心 ERP，后期可采用灰度/蓝绿，必要时双活确保业务不中断，保留回滚预案，迁移采用SMC、DTS实现数据库双写及增量同步，OSS导入，NAS数据同步等。

    7. **实施治理**，架构变更管理：
        - 在云里：
            - 建立监控告警（Prometheus/Cloud Monitor）。
            - 做安全审计、权限分级。
    
    ### 话术：我们会在实施过程中引入监控和审计，确保迁移不会引发大面积业务中断。

    8. **持续优化**、适应新需求：
        - 在云里：
            - 根据业务增长，增加弹性伸缩。
            - 引入 AI、大数据等新能力。

    ### 话术：上云后架构不是一成不变的，比如随着电商流量增长，我们会增加自动扩容策略，并逐步引入大数据分析平台。

    9. 需求管理，贯穿整个循环，不断校验需求变化。


### 话术：
#### 1.准备阶段：
我会先分析客户的上云**业务目标**（Business Architecture），比如是为了降本增效、数字化/AI转型、弹性等等，第二个会判断**迁移范围**，比如是全局迁移，还是部分系统迁移。考虑行业**约束条件**，比如客户成本预算，人工，和一些特定行业的约束比如金融行业的等保/PCI-DSS。最后评估风险与对应策略，比如从新的架构对其组织和企业架构有什么程度的影响。
可以补充一些其他考量,包括对**干系人分析**(Stakeholder Map)，谁是关键决策者、谁是技术推动者、谁是业务Owner，确保能满足干系人期望，**价值衡量标准(KPI定义)**，如TCO下降20%、交易延迟缩短30%、99.95% SLA。**合规与安全的前置审计**，比如在金融、政府等行业，需要在此阶段完成合规Gap分析，不然后期架构再怎么优化也落不了地。

#### 2. 业务架构视角：
理解企业的**核心业务系统**，理解企业业务是如何运转的，各个业务系统单独或者多系统之间时是如何运转，比如银行中的CBS(核心银行系统)，风控系统，电商的订单清单/库存/物流体系(ERP + CRM + SCM)和推荐算法(AI/大数据)系统，这些系统一旦停机就会导致业务中断，然后**区分可分阶段迁移的支撑系统**。结合最开始客户的业务目标，这一阶段可做一个初步的对比现有架构的运作方式和客户未来希望上云后的运作方式，理解有和区别，并评估所有可能的上云方式抉择最优选项，具体一些可以指定RPO/RTO目标，并产出系统**优先级矩阵（业务价值 × 技术复杂度），以及迁移波次划分。**

#### 3. 系统信息架构：
分析具体的**应用架构和数据架构**，应用架构包括根据应用之间依赖关系去组合，理解当前数据架构，包括数据的流转、存储方式、安全策略等。再具体分析架构中各应用是否允许改动，是否需要适合升级优化，是否需要做更改重写(更换中间件，更改后端数据后库等)，迁移策略实施矩阵(**六个R**)，Rehost(搬运)，Replatform(升级操作系统)，Repurchase(替换现有应用)，Refactor(重写)，Retire(退役)，Retain(保留在本地)。

#### 4. 技术层面：
设计一个**高可用的云原生架构**：**前端**走 CDN+WAF，**入口**走ALB/SLB, **身份和密钥**可以通过RAM/KMS管理，**应用层**用ACK/函数计算，**数据库**可以使用PolarDB/RDS(高可用/读写分离),Redis，RocketMQ，OSS等，可以通过ADB/MaxCompute做**风控和合规**，**监控方面**可以用阿里云原生的CloudMonitor和ARMS，SLS日志服务，**网络**可以使用基本的VPC，与本地互联可通过Express Connect或者VPN，后期可以补一些**容灾架构**，**成本与弹性治理**，**DevOps与CI/CD**结合阿里的DevOps工具。

#### 5. 机会和解决方案：
**结合客户的成本和战略**，提出**解决方案并落地迁移规划**（Opportunities & Solutions + Migration Planning），除了前面提到的**迁移策略实施举证和技术层面架构**以外，对整体迁移流程可以采用**分阶段方式**，小步快跑，并通过**迁移工单化与自动化(Runbook/Playbook)**来减少认为错误。第一阶段先迁辅助系统做验证，第二阶段迁核心 ERP，后期可采用灰度/蓝绿，必要时双活确保业务不中断，保留回滚预案，其中确保有**测试和演练迁移**。最后如何将方案呈现给客户，思考**客户沟通模型**，使用什么架构模型以及哪种理解的术语和指标去呈现给客户，比如金融客户喜欢风险合规指标，零售客户喜欢弹性与峰值应对，制造业客户更关心IT与OT打通。保证客户能够理解架构。

#### 6.实施与治理：
最后在实施治理引入**监控和审计**，确保迁移不会引发大面积业务中断，和持续优化中保证方案落地。这样能确保架构既满足业务需求，也具备**弹性和可扩展性**。
可以补充比如**FinOps治理**，现实中迁移完成后，客户最关心的是“为什么账单涨了”。需要引入成本监控+预算预警。**安全运营（SecOps）**，不仅是审计，还包括 安全基线合规扫描（如阿里云合规中心）、零信任策略。**SLA与SLO跟踪**，建议把客户关心的SLA写入治理目标，迁移后持续评估是否达到目标。

## 案例准备：
我们按 TOGAF 的业务→应用/数据→技术→迁移→治理的路径推进。
先用 Azure Migrate 做资产与依赖评估，按处置矩阵把 300+ VM 分为直接上云、托管 PaaS、后续容器化三类；
技术上落地 Hub-Spoke Landing Zone，走 ExpressRoute + Private Endpoint 全私网，安全与密钥统一在 Key Vault/Policy 治理；
迁移采用 ASR Replication Group 分波切换，在隔离测试 VNet里做自动化连通/性能校验；
每波切换遵循 Runbook，≤30 分钟窗口完成，且有蓝绿/回退预案；
上线后通过 Monitor + LA 做可观测，成本通过 rightsizing + 预留/节省计划持续优化。
最终 TTR 降低 50%+，CPU 利用率提升 20%，达到客户的 SLO/RTO/RPO 目标。”

2. ITSA
3. DODAF