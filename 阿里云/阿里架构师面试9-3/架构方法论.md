## 云架构设计方法论
1. TOGAF(Preliminary → Business Architecture → Application Architecture → Data Architecture → Technology Architecture → Opportunities&Solutions → Migration Planning → Implementation Governance → Architecture Change Management → Requirements Management)：
    1. 准备阶段，定义架构原则，目标和约束条件：
        - 确认客户上云的目标，比如是为了降本增效、数字化/AI转型、云的弹性，以及客户的侧重点是什么。
        - 确认约束条件，安全合规和预算边界。
        

    2. **业务架构**，理解企业核心业务流程、组织结构、战略目标。
        - 识别核心系统（ERP、CRM、MES）。
            > ERP 是核心调度，PLM 管设计，MES 管制造，WMS 管仓库，QMS 管质量，SCADA 管设备，OA 管流程，CRM/SCM 管客户与供应链。 

            ![alt text](/阿里云/阿里架构师面试9-3/image/image.png)

        - 区分业务关键性（核心系统 vs 支撑系统）。

    3. 信息系统架构：
        - **应用架构**：应用如何组合，依赖关系如何。
            - 在云里：哪些应用 SaaS 化，哪些容器化，哪些迁移到 VM。
        - **数据架构**：数据流转、存储方式。
            - 在云里：数据库迁移到 RDS，日志数据进大数据平台。
        
        #### 六个R
        - **Rehost** 服务器，没有积极升级路线图的应用，或者测试，开发环境直接搬到云上，本地更改最少。
        - **RePlatform**本地老的OS系统上云的时候进行升级,或者应用系统升级比如oracle8升级到oracle11。
        - **Repurchase**用saas方式或商用现成品软件替代已有软件。
        - **Refactor**之间维护软件工程师已离职，找不到第三方vendor支持的应用等原因，或者本地架构可能是一体化，又大又蠢的形式，希望使用云端松耦合形式，那么就会对组件进行重构设计，可能包含更改后端数据库，更换中间件，重构应用架构。
        - **Retire**退役本地某些服务器，比如由于合并或者收购产生的重复资源。
        - **Retain**不移动本地某些服务器，没有上云价值的legacy应用。    

            ![alt text](/阿里云/阿里架构师面试9-3/image/image1.png)

    4. **技术架构**，描述实现所需的技术组件：
        - 在云里：
            - 计算（ECS/VM、容器、Serverless）。
            - 存储（对象、块、文件）。
            - 网络（VPC、负载均衡、CDN、专线）。
            - 安全（WAF、防火墙、IAM）。

    5. **机会与解决方案**，把前面三层架构转化为落地方案：
        - 在云里：
            - 做 TCO 对比（成本 vs 本地机房）。
            - 选择云服务产品组合（ACK、OSS、RDS、Log Service）。
    
    ### 话术：结合客户预算，我们推荐采用对象存储OSS替代原有 NAS，数据库迁移到云上托管 RDS，或用SLS，CloudMontior代替本地监控和日志系统，也可以使用云端ACK逐步替代本地K8s集群，以及可以用函数计算取代一些后端不常用的API，实现减少运维成本，提升效率，提高高可用等。

    6. **迁移规划**，制定迁移路线图，分阶段执行：
        - 在云里：
            - 先 POC → 再分批迁移 → 最后核心系统。
            - 蓝绿/灰度/双活等切换策略。
    
    #### 话术：迁移采用分阶段方式，小步快跑，第一阶段先迁辅助系统做验证，第二阶段迁核心 ERP，后期可采用灰度/蓝绿，必要时双活确保业务不中断，保留回滚预案，迁移采用SMC、DTS实现数据库双写及增量同步，OSS导入，NAS数据同步等。

    7. **实施治理**，架构变更管理：
        - 在云里：
            - 建立监控告警（Prometheus/Cloud Monitor）。
            - 做安全审计、权限分级。
    
    #### 话术：我们会在实施过程中引入监控和审计，确保迁移不会引发大面积业务中断。

    8. **持续优化**、适应新需求：
        - 在云里：
            - 根据业务增长，增加弹性伸缩。
            - 引入 AI、大数据等新能力。

    #### 话术：上云后架构不是一成不变的，比如随着电商流量增长，我们会增加自动扩容策略，并逐步引入大数据分析平台。

    9. 需求管理，贯穿整个循环，不断校验需求变化。


## 案例准备：
客户是澳洲头部制造企业，双栈虚拟化托管三百多台VM，三层架构齐全。我们从业务目标出发，先与客户架构团队、虚拟化与网络运维确认窗口最短、稳定可回退、合规可控、迁后降本这四个锚点，同时统一SLA与RPO/RTO口径并明确干系人责任边界。随后用 Azure Migrate 做基线评估与右尺码：按P95性能样本加安全系数给出目标SKU，并输出就绪性整改清单；基于依赖图把系统分波次迁移——先无状态与可PaaS替代的Web/静态/跳板机，中间件与业务API第二波，核心数据库压轴，做到“外围先行、核心殿后”。
目标方案采用专线ExpressRoute+Recovery Services Vault私有终端，数据面全私网复制，控制面最小放通443，网络与权限按最小信任设计；发布层预置Front Door或AppGW以支持灰度/蓝绿与快速回滚。复制链路在本地部署ASR/迁移Appliance：VMware侧用CBT做初始全量后增量，Hyper-V侧用HRL日志跟踪；复制周期自适应为“上次耗时的一半，最短1小时最长12小时”。正式切换前先做Test Migration校验启动、挂盘序号、依赖端口与DNS，再进入Hydration由中介VM注入驱动/代理生成目标VM；切换瞬间执行Last Sync并关停源端，选择业务低谷夜窗，核心库实际停机约二十分钟。
落地过程中有三类典型挑战。我方快速闭环：其一是私网解析，一开始客户把Forwarder指向168.63.129.16导致PE不通，窗口期先以Hosts应急，随后用Private DNS Zone+条件转发长期修复；其二是IP变更导致耦合，优先以FQDN替代硬编码、降低TTL并把权威解析CNAME到Front Door，若改造成本高则在本地做DNAT/SNAT或反向代理保证回程对称；其三是高写入与带宽瓶颈，开启High-churn模式把缓存切到Premium Block Blob、分散到多存储账户并横向扩容Appliance，对极高写入的磁盘单列后置处理，同时实施分批复制与日夜限流策略。
结果方面，首波无状态工作负载大量改为PaaS，上云服务器量减半；通过右尺码、弹性与分层存储实现明显TCO优化；专线+PE+最小权限与全链路审计满足合规；分波+演练+可回退的发布策略保证窗口可控、零回滚事故。复盘看，这次是把TOGAF的“业务对齐—基线评估—目标架构—机会与方案—迁移计划—实施治理”完整工程化：先治理后迁移（账号/网络/DNS/权限基线），先演练后切换，能PaaS不硬搬迁，以数据面为王控制面最小暴露，最终实现“迁得上去、跑得稳、管得住、花得省”。

### TOGAF方法论：
#### 1.准备阶段：
我会先分析客户的上云**业务目标**（Business Architecture），比如是为了降本增效、数字化/AI转型、弹性等等，第二个会判断**迁移范围**，比如是全局迁移，还是部分系统迁移。考虑行业**约束条件**，比如客户成本预算，人工，和一些特定行业的约束比如金融行业的等保/PCI-DSS。最后评估风险与对应策略，比如从新的架构对其组织和企业架构有什么程度的影响。
可以补充一些其他考量,包括对**干系人分析**(Stakeholder Map)，谁是关键决策者、谁是技术推动者、谁是业务Owner，确保能满足干系人期望，**价值衡量标准(KPI定义)**，如TCO下降20%、交易延迟缩短30%、99.95% SLA。**合规与安全的前置审计**，比如在金融、政府等行业，需要在此阶段完成合规Gap分析，不然后期架构再怎么优化也落不了地。

#### 2. 业务架构视角：
理解企业的**核心业务系统**，理解企业业务是如何运转的，各个业务系统单独或者多系统之间时是如何运转，比如银行中的CBS(核心银行系统)，风控系统，电商的订单清单/库存/物流体系(ERP + CRM + SCM)和推荐算法(AI/大数据)系统，这些系统一旦停机就会导致业务中断，然后**区分可分阶段迁移的支撑系统**。结合最开始客户的业务目标，这一阶段可做一个初步的对比现有架构的运作方式和客户未来希望上云后的运作方式，理解有和区别，并评估所有可能的上云方式抉择最优选项，具体一些可以指定RPO/RTO目标，并产出系统**优先级矩阵（业务价值 × 技术复杂度），以及迁移波次划分。**

#### 3. 系统信息架构：
分析具体的**应用架构和数据架构**，应用架构包括根据应用之间依赖关系去组合，理解当前数据架构，包括数据的流转、存储方式、安全策略等。再具体分析架构中各应用是否允许改动，是否需要适合升级优化，是否需要做更改重写(更换中间件，更改后端数据后库等)，迁移策略实施矩阵(**六个R**)，Rehost(搬运)，Replatform(升级操作系统)，Repurchase(替换现有应用)，Refactor(重写)，Retire(退役)，Retain(保留在本地)。

#### 4. 技术层面：
设计一个**高可用的云原生架构**：**前端**走 CDN+WAF，**入口**走ALB/SLB, **身份和密钥**可以通过RAM/KMS管理，**应用层**用ACK/函数计算，**数据库**可以使用PolarDB/RDS(高可用/读写分离),Redis，RocketMQ，OSS等，可以通过ADB/MaxCompute做**风控和合规**，**监控方面**可以用阿里云原生的CloudMonitor和ARMS，SLS日志服务，**网络**可以使用基本的VPC，与本地互联可通过Express Connect或者VPN，后期可以补一些**容灾架构**，**成本与弹性治理**，**DevOps与CI/CD**结合阿里的DevOps工具。

#### 5. 机会和解决方案：
**结合客户的成本和战略**，提出**解决方案并落地迁移规划**（Opportunities & Solutions + Migration Planning），除了前面提到的**迁移策略实施举证和技术层面架构**以外，对整体迁移流程可以采用**分阶段方式**，小步快跑，并通过**迁移工单化与自动化(Runbook/Playbook)**来减少认为错误。第一阶段先迁辅助系统做验证，第二阶段迁核心 ERP，后期可采用灰度/蓝绿，必要时双活确保业务不中断，保留回滚预案，其中确保有**测试和演练迁移**。最后如何将方案呈现给客户，思考**客户沟通模型**，使用什么架构模型以及哪种理解的术语和指标去呈现给客户，比如金融客户喜欢风险合规指标，零售客户喜欢弹性与峰值应对，制造业客户更关心IT与OT打通。保证客户能够理解架构。

#### 6.实施与治理：
最后在实施治理引入**监控和审计**，确保迁移不会引发大面积业务中断，和持续优化中保证方案落地。这样能确保架构既满足业务需求，也具备**弹性和可扩展性**。
可以补充比如**FinOps治理**，现实中迁移完成后，客户最关心的是“为什么账单涨了”。需要引入成本监控+预算预警。**安全运营（SecOps）**，不仅是审计，还包括 安全基线合规扫描（如阿里云合规中心）、零信任策略。**SLA与SLO跟踪**，建议把客户关心的SLA写入治理目标，迁移后持续评估是否达到目标。

## 云宏观问题
#### 如果客户要求核心系统必须满足金融级业务连续性，你会怎么设计架构？
- 首先确认客户的 RPO/RTO 要求，以及行业合规要求（金融通常需要等保三级或PCI-DSS）。
- 架构上我会采用：
    - 同城双可用区部署（PolarDB、ACK 多 AZ）确保单 AZ 故障可快速切换；
    - 异地灾备中心，通过 DTS/日志同步做异地冷备或双活；
    - 网络层面使用 云企业网（CEN） 做跨地域互联，保证低延迟；
    - 灾备演练纳入治理流程。
- 这样可以满足 99.99% SLA 和金融客户的连续性要求。

#### 如果客户说上云太贵，怎么做成本优化？
- 成本优化要结合 FinOps 思路：
    1. 计算层：对于长期稳定负载，推荐预留实例/包年包月；对于波动型负载，推荐 Auto Scaling + 按量付费；部分容错任务可以用 抢占式实例。
    2. 存储层：冷热分层，日志放 OSS-IA/Archive，数据库冷热分离。
    3. 网络层：流量走 CDN/GA，减少跨境流量成本。
    4. 治理：用资源标签 + 成本中心，定期分析账单，避免“僵尸资源”。
- 在阿里云，可以结合 成本管控（Cost Center）、预算预警，帮助客户形成持续优化闭环。
#### 客户的应用是单体架构，要迁到云上，你会怎么处理？
- 迁移策略上先做评估，看应用是否必须立即微服务化：
    - 如果时间紧 → 先 Rehost（上云搬迁） 到 ECS/ACK，配合负载均衡和数据库托管，快速上云。
    - 中长期 → 推动应用解耦，逐步 Refactor 成微服务，数据库逐步分库分表，消息队列解耦。
- 给客户的价值：先实现上云目标和降本增效，再逐步完成数字化转型。
#### 如何理解 Landing Zone 在实际项目中的价值？
- 在阿里云，Landing Zone 是 上云的基线环境，价值体现在：
    - 多账号治理：通过资源目录 + RAM，统一权限和合规；
    - 网络基线：规划好 VPC、共享服务 VPC、CEN 互联；
    - 安全合规：预置安全基线、日志审计、合规中心。
- 案例：金融企业上云时，如果不先搭建 Landing Zone，后期会出现账号散乱、权限失控、网络孤岛，治理成本更高。
#### 如果迁移中数据库有 PB 级数据，怎么迁？
- 要根据数据量和时间窗口：
    - 在线迁移：用 DTS 做全量 + 增量同步，RPO 最低可到秒级。
    - 离线迁移：数据量太大时，用 Data Transport/数据迁移盒子（类似 AWS Snowball、Azure Data Box）。
    - 切换方案：先跑全量 + 增量，窗口期内冻结写入，完成切换。
- 最终要确保满足客户的 RPO/RTO 要求。
#### 如何保障云上应用的安全？
- 架构设计安全要分层：
    - 身份与权限：用 RAM 最小权限原则，配合 KMS 管理密钥；
    - 网络层：VPC + 安全组 + WAF，必要时零信任接入；
    - 数据层：数据库 TDE 加密、OSS 加密存储；
    - 监控与合规：ActionTrail、SLS 做审计，合规中心扫描。
- 这样既满足等保/PCI-DSS，又能防止误操作和入侵风险。
#### 架构师在迁移项目中最核心的价值是什么？
- 架构师的价值不仅是“画图”，而是：
    - 把 业务目标转化为技术架构；
    - 在 安全、合规、成本、弹性、性能 之间做平衡；
    - 输出可落地的最佳实践，减少后期风险。
- 简单说：不是解决问题，而是 预防问题 + 保障价值落地。

## 细节问题
#### 企业有混合云场景（IDC + 云），怎么设计网络互联？
建议使用 专线/VPN双通道冗余，结合 云企业网CEN 做全局路由，确保低延迟和高可用。
#### 跨境访问如何优化？
通过 CDN/GA 加速降低跨境延迟，合规需求下可选择 跨境专线，满足监管要求。
#### 不同 VPC 的业务系统如何互通？
可以使用 CEN 或 VPC Peering 建立互联，同时用安全组/ACL 做流量隔离。
#### 多云环境如何互联？
通常采用 专线网关互联或 VPN 隧道，统一 DNS 解析和流量策略，保证跨云通信稳定。
#### 如何避免单点网络出口？ 
采用 多AZ多出口部署，结合 SLB/ALB 冗余，提升容错能力。
#### 大型企业多账号体系如何设计？
通过 Resource Directory + RAM 统一管理，落地最小权限原则。
#### 如何避免“野生账号”和“野生资源”？
建立 集中化账号体系，配合 标签治理和预算管控，规范资源创建。
#### 如何隔离开发/测试/生产环境？
使用 独立账号/OU 管理环境，配合 RBAC 权限分离，防止误操作。
#### 如何实现统一身份认证（SSO）？
通过 RAM SSO 对接 AD/LDAP/IdP，实现本地与云端统一认证。
#### 如何在不停机的情况下迁移数据库？
采用 DTS 全量+增量同步，最后在窗口期冻结写入并切换。
#### 迁移中如何保证数据一致性？
使用 双写校验工具，比对校验后再完成切换。
#### 老旧数据库（如 SQL Server 2008）如何迁移？
先做 版本升级或导出导入，再迁移到云数据库。
#### PB 级历史冷数据如何处理？
分层存储：热数据保留在数据库，冷数据转存到 OSS-IA/Archive。
#### 如何实现数据库读写分离？
通过 RDS/PolarDB 主从复制 + Proxy，提升性能和可扩展性。
#### 本地 NAS 如何替换？
使用 阿里云 NAS 或 OSS，兼容 SMB/NFS 协议。
#### 两地三中心架构怎么设计？
同城双活 + 异地灾备，核心系统异地热备，满足金融级容灾。
#### 如何实现秒级 RPO、分钟级 RTO？
通过 数据库双活 + 日志同步 + 自动故障转移 实现。
#### 如何验证备份的可恢复性？
必须做 定期恢复演练，而不是只依赖备份状态。
#### 单体应用如何迁到云？
先 Rehost 搬迁 到 ECS/ACK，后续逐步 Refactor 微服务化。
#### 如何做灰度、蓝绿发布？
灰度 → 按比例逐步放量；蓝绿 → 双环境“一键切换”，快速回滚。
#### 高并发场景如何应对？
利用 Auto Scaling + 缓存 (Redis) + MQ 削峰填谷。
#### 传统中间件上云如何替代？
用 阿里云 MSE、RocketMQ、EDAS 替代传统中间件。
#### 如何设计统一监控体系？
基础设施用 CloudMonitor，应用链路用 ARMS，日志用 SLS，全栈覆盖。
#### 系统性能瓶颈如何排查？
先看 基础指标（CPU/IO），再下钻到 SQL/代码调用链。
#### 如何避免告警风暴？
采用 告警分级、抑制和聚合 策略。
#### 如何处理 TB 级日志？
通过 SLS 分区采集 + 热冷存储分层，提升查询效率。
#### 如何确保等保三级/PCI-DSS？
落地 安全基线 + WAF + 合规中心，覆盖审计和检测。
#### 数据跨境如何合规？
采用 跨境专线/加密通道，并遵守区域数据管控政策。
#### 如何防止密钥泄露？
使用 KMS/HSM 托管密钥，严格最小权限调用。
#### 如何对接客户现有的 SIEM/SOC？
用 ActionTrail/SLS 输出日志，统一对接 SIEM。
#### 如何避免僵尸资源？
定期巡检，配合 自动关停策略。
#### 如何做成本分摊与预算？
使用 标签、账单中心、成本中心 做归属。
#### 周期性峰值如何降本？
Auto Scaling + Spot 实例 动态扩缩。
#### 如何量化降本效果？
通过 TCO 对比，展示迁前 vs 迁后的账单和利用率。
#### 迁移波次如何划分？
用 业务价值 × 技术复杂度矩阵，先迁辅助系统，再迁核心。
#### 如果依赖系统未准备好怎么办？
采用混合部署/推迟波次，避免全局停滞。
#### 回滚方案如何设计？ 
保留双环境，切换失败时立即回滚旧系统。
#### 如何做迁移/灾备演练？
先做沙箱演练，再做小规模演练，确保可操作性。
#### 迁移后如何持续优化？
持续 FinOps 成本优化 + 安全合规扫描 + 架构Review。

## 通识问题
#### 怎么理解云架构师这个岗位？
我理解架构师不是单纯的技术岗位，而是要**从客户业务目标**出发，结合行业特点和阿里云的云原生的优点，设计可落地的云上架构方案。
需要帮助客户实现降本增效、数字化/智能化转型，并保障系统的高可用和业务连续性，比如设计两地三中心、金融级双活、云原生弹性架构。
同时，架构师要能把复杂的技术方案转化为客户能理解的语言，用阿里云最佳实践去落地，并在迁移、运维、治理的全周期里，持续优化客户的上云价值。
#### 为什么想来这个岗位？你的优势是什么？
在我现在的工作里，我主要支持客户在 Azure 上做迁移和容灾，帮助他们解决上云过程中遇到的技术问题。通过这些经历，我越来越发现，仅仅解决问题还不够，我希望能够在更早的阶段帮客户从业务目标出发，去前瞻性地规划上云路径，提前规避风险和最佳实践是我更加热衷的方向。
Support Engineer 的工作让我有了扎实的技术底层功底，比如网络、存储、数据库、备份、RPO/RTO，这些都是架构设计的基础。同时，我在和客户沟通 RCA、方案时，也锻炼了把复杂问题翻译成客户能理解语言的能力。
所以对我来说，转型架构师并不是跨行业，而是一个自然的职业延伸：从‘解决问题的人’，成长为‘设计系统、预防问题的人。

#### 未来五年的职业规划？
我希望把support engineer积累的大量一线迁移，容灾的经验和技术平滑迁移到未来架构师的岗位，短期 1-2 年，迅速积累架构师的基本功和快速上手理解阿里云产品的优势，深入掌握云厂商原生服务+混合云/多云架构，提升 客户沟通、方案设计、POC验证 的能力。完成从支持工程师到架构师的转型，能够独立完成从需求分析到架构设计与落地交付的完整流程。
中期第 3 年，在某个架构方向上沉淀为专家，比如业务连续性与高可用架构，能够主导更大规模的迁移项目，并输出最佳实践。

#### 对良好架构框架和Landing Zone（上云登陆区）的理解
我对云上架构设计方法论是有了解和应用过的。我一直认为没有一个标准答案的良好框架，根据不同客户的业务目标和现有架构去帮助客户降低上云风险以及实现上云目的才是最终目标。基于此，可能会从可靠性、安全性、性能效率、成本优化、运维等多个维度去评估现有架构，确保迁移后的系统既满足 SLA，又能持续优化。

Landing Zone（上云着陆区），，就是帮助客户在上云初期就打好‘地基’，主要是指企业大规模上云的统一基线环境。它会在上云初期就规划好 多账号体系（Resource Directory/资源目录），并结合 RAM 权限体系 做集中化管控；
在网络层面，着陆区会通过 VPC、共享服务VPC、专线/VPN/云企业网CEN 提前设计好网络边界和互通方式，避免后期出现‘烟囱式’孤岛架构；
在合规和安全方面，会预置 安全基线、访问控制策略、日志审计（ActionTrail、SLS），确保金融、政企等行业客户满足等保、ISO、PCI-DSS 等合规要求。避免后期出现‘野生资源’、权限失控或合规隐患。我在支持客户迁移时也见过，如果没有 Landing Zone，后期治理成本会非常高。
所以我在未来做架构设计时，会结合这些方法论，不仅解决客户的当下需求，还要确保上云架构具备长期可扩展和可治理的能力。
2. ITSA
3. DODAF