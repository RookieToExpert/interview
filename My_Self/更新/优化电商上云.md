澳洲电商客户 Azure 上云与架构优化项目客户原先在本地自建 IDC，约 20 台 VM 支撑核心电商业务。随着业务增长，他们希望整体迁移到 Azure 平台，并逐步采用 PaaS、SaaS 服务，以降低运维复杂度、提升性能与可用性，并为未来扩展预留空间。

## 前期规划与基础落地
设计并落地 Landing Zone：完成订阅、资源组、命名与标签规范；在客户当前架构中的具体角色与配合如下：Hub–Spoke 网络：Hub 承载公共组件（Bastion、日志采集出口、可选防火墙），集中管理路由与策略；每个业务域独立 Spoke（例如 Spoke-App、Spoke-Data），Spoke 之间默认隔离，仅通过对等互连按需放通（最小访问）。Private DNS：创建 privatelink.* 专用区域并链接到所有 Spoke，让 Spoke 内的 App/容器访问 Blob、MySQL Flexible、Redis、AI Search 等 Private Endpoint 时走内网解析与私有回源。NAT Gateway：绑定到 Spoke-App 子网，统一互联网出站并提供固定 egress IP，便于第三方白名单与审计（Spoke-Data 一般不出网）。Azure Bastion：部署在 Hub，供运维从浏览器安全登录各 Spoke VM/跳板机，无需给 VM 开公网 IP。监控：各 Spoke 的 VM/容器/数据库代理将指标与日志汇聚到 Log Analytics Workspace，结合 Azure Monitor + App Insights 做仪表盘、告警与追踪。

## 安装并配置 Azure Migrate Appliance，对本地 VM 环境进行发现与评估：
- 资产清单：自动发现 vCenter/Hyper-V/物理机，采集 OS/内核、vCPU/内存、磁盘与挂载、网卡/子网、标签/所属业务等；
- 依赖与拓扑：启用依赖可视化（进程/端口/入出站连接），识别“必须同迁”的应用组与南北/东西向流量；
- 性能基线：持续 14–30 天采样 vCPU/内存、磁盘 IOPS/吞吐/延迟、网络带宽/PPS，输出峰值、均值与 P95/P99；
- 容量与规格建议：据基线右尺⼨ VM（系列/尺寸/磁盘类型），并给出可改造为 PaaS/容器的候选清单；
- 兼容性/就绪度：检查 OS/驱动/代理、UEFI/BIOS、磁盘/加密、备份/杀毒/内核模块、时间同步、NTP/DNS 等；
- 成本与 SLA 映射：结合节省计划/预留实例生成 Azure 成本估算，建议多可用区/备份与恢复策略；
- 并结合 Azure Database Migration Service (DMS) 进行数据库评估与迁移方案：
- 架构盘点：实例/库/表/分区/字符集/存储引擎、连接池与驱动版本；
- 兼容性：函数/存储过程/触发器/事件/视图、权限/RBAC、版本差异与不支持特性；
- 性能与容量：连接数、QPS、慢 SQL、热点表与索引、备份窗口与 PITR 需求；
- 迁移策略：全量+持续复制、低峰切换、数据校验与回滚预案、只读副本与读写分离设计。

## 存储与对象数据迁移
- 本地 4 台 FastDFS Storage 服务器迁移至 Azure Blob (ADLS Gen2)，并开启版本管理、软删除与生命周期策略。
- 采用 Azure Data Box 离线迁移 80TB 存量数据，结合 AzCopy 做增量与后续同步。
- 应用层启用 双写机制（先写 Blob，再异步写 FastDFS），通过 Front Door 回源机制 实现平滑切换与快速回滚。完成一致性校验与观察窗口后，逐步停写、切只读，最终下线本地 FastDFS。

## 网络与边缘层替代
- 本地边缘 Nginx/HAProxy 替换为 Azure Front Door Premium（自带 CDN 与 WAF），实现全球加速、负载均衡与应用层防护。

## 数据库与缓存迁移
- MySQL 主从数据库通过 DMS 在线迁移至 Azure Database for MySQL Flexible Server（ZRS 高可用），迁移过程中使用全量+持续复制，低峰期短暂冻结写入完成连接切换与验证。
- Redis 先以旁路缓存方式引入 Azure Cache for Redis (Premium)，逐步提升命中率并切换读写路径，替代本地 2 台 Redis。

## 应用与容器化改造
- 无状态 Web App 直接迁移至 App Service 与 Container Apps，结合 Deployment Slot/Revision 实现灰度与金丝雀发布。
- 静态前端迁移至 Azure Static Web Apps，降低成本与加速交付。
- 第二阶段规划进一步引入 AKS (Azure Kubernetes Service)，支撑更复杂的微服务与容器编排需求。

## 迁移批次与实施步骤
- 批次一：迁移 7 台服务器（Web/API×3、Elasticsearch×2、FastDFS Tracker×2）至 Azure；
- 批次二：建设 Blob（含版本/软删/生命周期），启用 Data Box，完成存储数据导入；
- 批次三：使用 DMS 建立 MySQL 全量+增量迁移桥接；
- 批次四：Front Door/WAF/CDN 上线，切换业务入口与回源策略就位；
- 批次五：应用灰度迁移至 App Service/Container App，前端迁 Static Web Apps，Redis 切至 Azure Cache。

## 成果与价值
- 实现业务整体从本地 IDC 向 Azure 平稳迁移，确保业务连续性与数据一致性；
- 替换存储、缓存、负载均衡等高运维负担组件为云端托管服务，显著降低运维压力与成本；
- 上云后应用具备更强弹性扩展与高可用能力，为后续多 Region 容灾与 AKS 微服务化演进打下基础。

