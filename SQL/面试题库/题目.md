# 🎯 数据库面试模拟问答清单（含示例回答）

## 1. SQL 与基础概念
**Q1：事务的 ACID 特性是什么？为什么重要？**  
- 示例回答：  
> 事务必须满足 ACID：  
> - **原子性** 保证要么全成功要么全失败；  
> - **一致性** 保证数据从一个合法状态到另一个合法状态；  
> - **隔离性** 保证并发事务互不干扰；  
> - **持久性** 保证提交后数据不会丢失。  
> 这对于金融、电商系统等要求强一致性的场景非常重要。  

---

**Q2：索引是什么？为什么查询会变快？**  
- 示例回答：  
> 索引相当于书本的目录，数据库通过索引定位数据而不是全表扫描。  
> - B-Tree 索引适合范围查询、排序；  
> - Hash 索引适合等值查询。  
> 正确建立索引能显著减少 IO 和扫描行数。  

---

## 2. 性能与优化
**Q3：发现 SQL 很慢，你会怎么排查？**  
- 示例回答：  
> 我会先用 `EXPLAIN ANALYZE` 查看执行计划，确认是否使用了索引；  
> 然后检查表的统计信息是否过期；  
> 再检查是否存在锁等待或连接池耗尽；  
> 最后才考虑 SQL 重写或表分区。  
> 如果在云环境，还会结合监控看 CPU/IOPS 是否成为瓶颈。  

---

**Q4：数据库 CPU 打满可能有哪些原因？**  
- 示例回答：  
> 常见原因有：  
> - 慢 SQL 导致全表扫描；  
> - 缺少索引，join 或排序耗费 CPU；  
> - 连接池配置过大，产生大量上下文切换；  
> - 热点数据竞争严重。  
> SRE 会通过 `pg_stat_activity` 或慢查询日志定位，再优化索引或做限流。  

---

## 3. 高可用与容灾
**Q5：如何保证数据库的高可用？**  
- 示例回答：  
> 通常做法是主从复制 + 自动故障转移，例如 PostgreSQL 用 Patroni、MySQL 用 MHA。  
> 在云上可以选择托管数据库（如 Azure Database 的高可用模式），结合跨区备份来满足 RPO/RTO。  
> 同时应用层也需要具备自动重连机制，避免连接失败。  

---

**Q6：你如何理解 RPO 和 RTO？**  
- 示例回答：  
> **RPO** 指最大可接受的数据丢失时间，例如 RPO=5 分钟表示最多丢 5 分钟的数据；  
> **RTO** 指最大容忍的恢复时间，例如 RTO=30 分钟表示必须在半小时内恢复服务。  
> 在容灾设计时，SRE 会和业务方确认 SLA，再选择合适的备份与恢复机制。  

---

## 4. 云数据库与迁移
**Q7：客户要把 PostgreSQL 从 VM 迁到 Azure Database for PostgreSQL，你会怎么做？**  
- 示例回答：  
> 如果能接受停机，可以用 `pg_dump/pg_restore`；  
> 如果要尽量无停机，可以用 DMS 或逻辑复制，甚至双写+CDC 来保证数据一致性。  
> 在迁移过程中要评估存储大小、网络带宽，设计切换窗口，确保 RPO/RTO 满足要求。  

---

**Q8：关系型数据库和 NoSQL 的选择标准是什么？**  
- 示例回答：  
> - 关系型数据库适合需要强一致性和复杂查询的场景，比如订单、支付。  
> - NoSQL 更适合高并发、低延迟、灵活 schema 的场景，比如缓存、日志、推荐系统。  
> 实际企业架构中经常会采用混合模式，例如交易数据在关系型数据库，缓存和会话存储在 Redis。  

---

## 5. SRE / 运维视角
**Q9：你会监控数据库哪些核心指标？**  
- 示例回答：  
> 我会重点关注：  
> - **性能**：QPS、延迟、错误率；  
> - **资源**：CPU、内存、IOPS、连接数；  
> - **健康**：锁等待、死锁数、慢查询数；  
> - **存储**：磁盘空间、WAL 日志增长速度。  
> 这些指标会通过 Prometheus+Grafana 或 Azure Monitor 设置告警，并与 SLO 对齐，例如“99.9% 请求延迟 < 200ms”。  

---

**Q10：主库宕机了，你会怎么处理？**  
- 示例回答：  
> 首先确认告警和日志，判断是数据库进程挂了还是节点宕机；  
> 如果是单节点故障，触发故障转移，把从库提升为主库，并通知应用层切换连接；  
> 如果是云托管数据库，通常会自动完成 Failover，但我会重点关注恢复时间是否满足 RTO；  
> 事后需要进行数据一致性校验。  

---

## 6. DevOps / 自动化
**Q11：如何在 CI/CD 流水线里管理数据库 schema 变更？**  
- 示例回答：  
> 我会使用 Flyway 或 Liquibase 管理 DDL 脚本，把 schema 变更版本化；  
> 在流水线中自动执行迁移脚本，保证各环境一致；  
> 每次变更都必须可回滚，避免在生产直接执行危险的 `ALTER TABLE`。  

---

**Q12：如何用 IaC 管理数据库？**  
- 示例回答：  
> 我会使用 Terraform 定义数据库实例的存储大小、备份策略、HA 配置，并放在 Git 中进行版本控制；  
> 结合流水线实现自动化部署和配置，避免手工操作不一致；  
> 这样可以快速恢复环境，也能保证数据库配置可追溯。  

---
# ⚡ 数据库面试速记清单（12题，一句话版）

1. **ACID**：事务必须满足原子性、一致性、隔离性、持久性，保证数据可靠。  
2. **索引**：相当于目录，加快查询；B-Tree 适合范围查询，Hash 适合等值查询。  
3. **慢 SQL 排查**：先看执行计划，检查索引/统计信息/锁等待，再优化 SQL 或分区。  
4. **CPU 打满原因**：全表扫描、缺少索引、连接池过大、热点竞争。  
5. **高可用**：主从复制 + 自动故障转移，云数据库自带 HA；应用层要支持重连。  
6. **RPO/RTO**：RPO = 最大数据丢失时间，RTO = 最大恢复时间，直接决定容灾方案。  
7. **迁移上云**：停机可用 pg_dump/restore，无停机用 DMS/逻辑复制/CDC，注意切换窗口。  
8. **选型标准**：关系型适合事务和复杂查询；NoSQL 适合高并发、灵活 schema。  
9. **监控指标**：QPS/延迟/错误率、CPU/内存/IOPS、锁等待/死锁、磁盘空间/WAL。  
10. **主库宕机处理**：触发 Failover 提升从库为主库，应用切换连接，事后校验数据一致性。  
11. **Schema 变更管理**：用 Flyway/Liquibase 做 DDL 版本化，流水线执行，必须可回滚。  
12. **IaC 管理数据库**：用 Terraform/ARM/Bicep 定义 DB 配置，版本控制，流水线自动部署。  
