# 云成本优化工程师面试速查表

## 一、计算 / 存储 / 网络：产品特性与计费规则对照

### 1) 计算（VM/容器/弹性策略）

| 维度 | Azure | 阿里云 | AWS |
|---|---|---|---|
| 实例家族 | `Dv*`、`Ev*`、`F`、`L`、`M`、`HB/HC`；Spot；Dedicated Host | `g`、`c`、`r`、`i`、`ecm`、`gn`；抢占式；专有宿主机 | `t/m/c/r/xz`；Spot；Dedicated Host |
| 计费粒度 | 秒级；按量、预留、节省计划 | 秒/分钟级；包年包月、按量、预留、抢占式 | 秒级；On-Demand、Reserved、Savings Plans、Spot |
| 自动伸缩 | VMSS、AKS CA、弹性策略 | ESS、ACK CA、弹性保障 | ASG、EKS CA |
| 停机计费 | deallocated 不收计算费；存储/IP 仍收 | 停机不收计算费；盘/IP 仍收 | stopped 不收计算费；EBS/EIP 仍收 |
| 容器服务 | AKS 控制面多数免费；节点付费 | ACK 控制面小额费；节点付费 | EKS 控制面付费；节点付费 |

### 2) 存储（对象/块/文件/归档/快照）

| 维度 | Azure | 阿里云 | AWS |
|---|---|---|---|
| 对象存储层级 | Blob：Hot/Cool/Archive | OSS：Standard/IA/Archive/Cold Archive | S3：Standard/IA/One Zone-IA/Glacier/Deep Archive |
| 计费构成 | 容量+请求+出站+解冻费+复制 | 容量+请求+下行+解冻费+复制 | 容量+请求+下行+解冻费+复制 |
| 块存储 | Managed Disk：Premium/Std/Ultra | ESSD PL0-3、Std SSD、HDD | EBS gp3/io2/st1/sc1 |
| 文件存储 | Azure Files (SMB/NFS) | NAS (SMB/NFS) | EFS |
| 冗余 | LRS/ZRS/GRS/GZRS | 本地/同城/跨区 | 单区/多区/跨区复制 |

### 3) 网络（LB/NAT/带宽/专线）

| 维度 | Azure | 阿里云 | AWS |
|---|---|---|---|
| 负载均衡 | Load Balancer、AppGW(WAF)、Front Door(全局) | SLB、ALB、GA | NLB、ALB(WAF)、GA |
| 计费规则 | 监听/处理量/LCU/跨区流量 | 实例费+流量+连接数 | LCU+流量 |
| NAT | NATGW：小时+处理量 | NATGW：实例费+流量 | NATGW：小时+流量 |
| 带宽 | 出站计费；区内免费 | 下行计费；跨区收费 | 下行计费；跨 AZ/跨区收费 |
| 专线 | ExpressRoute | 专线连接 | Direct Connect |

---

## 二、脚本与治理

### A) 闲置资源清理

典型清单：
- 停机未释放 VM
- 无挂载磁盘
- 空 LB/目标组
- 长期低 CPU/网络实例
- 闲置 EIP/NATGW
- 长期未访问对象存储
- 冗余快照/镜像

**Azure CLI**
```bash
# 未挂载磁盘
az disk list --query "[?managedBy==null].{name:name,rg:resourceGroup}" -o table

# 停机但仍挂高价盘/IP
az vm list -d --query "[?powerState=='VM deallocated'].{name:name,rg:resourceGroup,publicIps:publicIps}" -o table
```

**AWS CLI**
```bash
aws ec2 describe-volumes --filters Name=status,Values=available
aws ec2 describe-instances
```

**阿里云 CLI**
```bash
aliyun ecs DescribeDisks --Status Available
aliyun vpc DescribeEipAddresses --Status Available
```

### B) 成本异常控制
**Azure**
```bash
az costmanagement query -t ActualCost --timeframe MonthToDate \
 --dataset '{"granularity":"Daily","aggregation":{"cost":{"name":"PreTaxCost","function":"Sum"}}}'
```

**AWS**
```bash
aws ce get-cost-and-usage \
 --time-period Start=$(date -d "-7 days" +%F),End=$(date +%F) \
 --granularity DAILY --metrics "BlendedCost" --group-by Type=DIMENSION,Key=SERVICE

```
**阿里云**
```bash
BSS OpenAPI: QueryBill, QueryInstanceBill
```
### C) 用量预测
**AWS Forecast**
```bash
aws ce get-cost-forecast \
 --time-period Start=$(date +%F),End=$(date -d "+30 days" +%F) \
 --metric BLENDED_COST --granularity DAILY --forecast-model LINEAR
```

## 三、落地策略（Policy / Tag）
### Azure 架构
- 管理组 → Subscription (按环境) → Resource Group (按应用/平台)

- Policy：

    - 强制标签 env/app/owner/costcenter

    - 区域/SKU 白名单

    - 禁止公网 IP，必须私网访问 PaaS

    - 强制日志投递 Log Analytics

    - 磁盘/存储必须加密

- 标签示例

```bash
env=prod|staging|dev
app=order|payment
owner=alice
costcenter=FIN-APAC-123
rto=1h
rpo=30m
```
### 阿里云架构
- 资源目录 → 账号/文件夹 → 资源组

- Cloud Config：

    - 禁止公网访问

    - 必须加密

    - 必须投递审计日志

- 标签示例
```bash
env=prod|dev
app=coffee
owner=bob
costcenter=CN-OPS-001
```
## 四、面试话术提纲

1. 成本维表：订阅×环境×应用×服务，统一导出进数据湖。

2. 闲置治理：每周扫描 → 打标签 cleanup-candidate=true → 7 天后回收。

3. 异常检测：每日时序成本，与环比/预算比对 → 异常 15 分钟内告警。

4. 用量预测：Prophet 下月预测，提前告警。

5. 策略落地：Policy/Cloud Config 强制执行；Hub&Spoke 网络；全量标签。