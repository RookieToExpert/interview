## AI初创公司厂商上云需求
#### 当前环境：
- 网络划分：

    ![alt text](image-1.png)

- 资产盘算:

    - 计算:
        - GPU 服务器：50 台（训练用，8×A100 80GB/台，NVLink，双 100GbE）
        - CPU 服务器：30 台（推理 & 业务/中间件）

    - 存储：
        - 对象/块存储集群：24 台存储节点（Ceph：S3 兼容 + RBD）

        - 文件存储 NAS：4 台（NFS，热数据、高并发小文件）

    - 网络设备:
        - 边界防火墙 ×2（HA）
        - 核心交换机 ×2（MLAG/堆叠）
        - 汇聚/接入交换机 ×若干
        - VPN/专线 CPE ×2（双活/主备）

    - 管理与安全：
        - 跳板机（Bastion）×2
        - 监控/日志（Prometheus+Loki/ELK）×2
        - Git/CI（GitLab+Runner）×2
        - 密钥库（HashiCorp Vault）× 1
#### 业务驱动力和上云目标：
- 弹性不足，成本压力，存储瓶颈，交付慢，迁移要求：大量有状态服务，如何迁移不中断？GPU驱动，框架兼容问题
#### 当前架构：
- 迁移范围：
    - 第一阶段：核心推理服务（CPU 节点）+ 数据库/缓存 → 上云，先保证客户 API 全国可用。
    - 第二阶段：GPU 训练环境逐步迁到百度云，保留少量本地 GPU 做实验。   
    - 第三阶段：全量迁移，IDC 逐步关停。
- 迁移的需求：
    - 推理核心服务，采用rehost的方式，通过CMC方式平滑迁移至百度云GPU服务器，后期通过replatform的方式，迁移到百度智能云AI Studio平台
    - 静态网页，web应用：采用replatform的方式，通过将镜像部署到CCE(百度的AKS)中，需在源代码中修改部分连接串
    - 数据库：通过replayform的方式通过DTS迁移到百度RDS中，将源代码中连接sql字符串修改
    - 本地堡垒机，防火墙，交换机，VPN专线等replace的方式，使用云上堡垒机，安全组及acl及VPC中抽象的交换机代替。
    - 文件系统通过replatform的方式，通过BOS采集工具上传至BOS中，Ceph/NAS → BOS/CFS，需要调整文件存储的挂载路径或 API。
    - 监控和日志通过Replatform → 迁移到 百度智能云 云监控 (Cloud Monitor, BMS)，支持Prometheus 采集。Refactor → 使用 百度智能云 日志服务 (BLS)，替代 ELK，降低维护成本。
    - 密钥库通过replace的方式，用百度智能云KMS(密钥管理服务)，用云 KMS/STS 临时凭证替代本地账号密码，需修改应用配置文件。
    - 本地Git/CI初期可通过replatform将 GitLab Runner 部署在 百度智能云 BCC VM / CCE 容器上，后续 Replace → 百度智能云 CodeHub + CCE 原生 CI/CD，获得云原生集成。
- 集成复杂度：
- 兼容性：
- 安全合规和约束条件：视频和图像数据涉及零售/安防，必须遵守 数据本地合规，不能将数据转存到境外，必须用百度云的 国内节点，允许 30 分钟内的割接窗口，数据库必须支持 增量迁移，不能丢数据，传输链路必须 加密（VPN/专线），不能明文走公网，上云后必须有 VPC 隔离、WAF、防火墙、安全组策略。
- 预算成本：整体 TCO 不超过现在 IDC 成本的 70%， 可以用 抢占式 GPU / 混合云训练 降低成本，希望用 冷热分层（热数据 CFS/冷数据 BOS 归档），优先考虑 VPN/专线混合，但专线带宽不能太贵。

#### landing:
- 1. 建立多租户/多订阅架构：生产环境，AI训练环境，开发/测试环境，共享服务(Bastion、CI/CD、监控、AD/LDAP)。
- 2. 网络架构落地 (Hub-Spoke)：
    - Hub VPC/VNet：管理与安全（Bastion、监控、CI/CD、KMS）。
    - Spoke VPC/VNet：
        - Spoke 1：Web/API 无状态区（CCE/K8s 节点）。

        - Spoke 2：数据库区（RDS、Redis、Kafka）。

        - Spoke 3：存储区（BOS/CFS）。

        - Spoke 4：GPU 集群（训练/推理）。
    - 使用 专线/VPN/高速通道 连接 IDC → 云 → 全球区域。
- 3. 安全治理：全面接入 IAM + RBAC：不同团队分配细粒度权限，所有敏感信息交由 KMS/STS 管理，替代硬编码账号，安全组与 ACL 统一策略化管理
- 4. 运维与监控：Prometheus → 云监控 (BMS/Azure Monitor)，ELK → BLS / Log Analytics，集中采集 + 审计。
- 5. CI/CD 与 DevOps：先准备好 容器平台 (CCE/AKS)、镜像仓库、网络、安全基线。
- 6. 合规与策略：定义 基础安全策略（密码复杂度、日志保存 180 天），强制资源标记（Tagging），用于计费/审计/成本优化，落地 FinOps，监控 GPU/存储成本。

#### 开始迁移阶段(先核心服务器，再推荐服务，再其他服务)：
1. 针对核心推荐服务GPU节点，通过CMC方式在线迁移到百度云GPU服务器
2. 针对CPU节点中静态网页和web应用，通过将镜像打包纸百度镜像仓库，并通过镜像部署方式到百度智能云CCE中
3. 针对数据库通过DTS在线不停机的方式去迁移至百度RDS中
4. 针对文件系统，通过采集工具上传至BOS中

#### 测试阶段：
1. 前期先不切流量，在云端验证各应用之间API能跑通，运行一个影子环境，行业里叫 Pilot Light / Shadow Migration，是个过渡阶段。

#### 正式割接：
1. 把实际业务流量切换到云端，停用或逐步下线本地 IDC：
    - 数据：完成 最终增量复制 + 数据校验。

    - 应用：通过 蓝绿/金丝雀发布 切换流量。

    - 网络：调整 DNS / 负载均衡指向云端。

    - 运维：监控迁移后性能指标，确保 SLA 达标。

#### 进一步优化：
根据最开始的方案，逐步优化当前架构：
- 推理核心服务运行在百度云的GPU服务器迁移到百度智能云AI Studio平台
- 云监控 (Cloud Monitor, BMS)通过refactor的方式迁移到百度智能云 日志服务 (BLS)，替代 ELK，降低维护成本。
- BCC及CCE的原生CI/CD替换成云原生集成CodeHub。


#### 准备阶段：
- 云上landing zone：
    - 安全性(网络安全，数据安全，主机安全，应用安全)：
        - **潜在隐患**：数据泄漏，身份、凭证和访问管理不足，不安全的接口和应用程序编程接口，系统漏洞，账户劫持，恶意内部人员，高级持续性威胁，数据丢失，滥用和恶意使用云服务，DoS，共享的技术漏洞
        - 上云的关键**安全需求**：
            - **业务连续不中断**：防网络攻击，防黑客入侵，法律遵从、合规
            - **远程全程可管控**：配置安全策略，风险识别和处置，操作可审计、追溯
            - **数据保密不扩散**：防内部窃取，内部非授权员工不可见，云服务商不可见
        - **具体服务**：
            - **网络安全**：
                - Anti-DDoS
                - DDoS高防
                - VPC/安全组
                - 端云协同保护
            - **主机安全**：
                - 主机WAF
                - 主机入侵检测
                - 主机漏洞管理
            - **应用安全**：
                - Web应用防火墙
                - Web扫描
                - 云WAF
                - 编码扫描
                - 网页防爬虫
            - **数据安全**：
                - 数据库安全，审计，防火墙，脱敏
                - 专属加密服务
                - 密钥管理
                - 密钥对登陆
        
        云上系统安全架构设计建议：
    
        ![alt text](image.png)

    - 可用性(单AZ可用性，跨AZ容灾，跨AZ双活，异地容灾部署(两地三中心))：
    - 可拓展性(水平扩展或垂直扩展)：
    - 性能(性能方案，性能检查，性能监听和性能权衡)：
    - 成本(成本设计，成本优化，合理使用宽带以及预估宽带使用率)：